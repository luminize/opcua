# initial cmake CMakeLists.txt file for building a server
# out of the open62541 library examples
# applicable library files have been generated by the open62541
# project and put in the shares_62541 directory.
#
# build "shared libs" and "amalgamated" so we use the generated
# open62541.h/.c files from the open62541/build directory
# and the 4 files in open62541/build/bin/Debug directory
#
# after compiling and linking, make sure to copy the
# open62541.dll file to the build/Debug directory
#
# from the root/build directory of this project (opcua):
# cmake ..
# cmake --build .


cmake_minimum_required(VERSION 3.10)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

project(server-instantiation VERSION 1.0)

#target_sources(${PROJECT_NAME} ${PROJECT_SOURCE_DIR}/src/server-instantiation)
include_directories(${PROJECT_SOURCE_DIR}/shared_62541)

add_executable(${PROJECT_NAME} ${PROJECT_SOURCE_DIR}/src/server-instantiation.c ${PROJECT_SOURCE_DIR}/shared_62541/open62541.h)

target_link_libraries(${PROJECT_NAME} ${PROJECT_SOURCE_DIR}/shared_62541/open62541.lib)

message("-- CMAKE_CURRENT_BINARY_DIR: ${CMAKE_CURRENT_BINARY_DIR}")

# copy the (provided or generated) open62541 dll to the binary build location
add_custom_target(copy_open62541_dll)
add_custom_command(
        TARGET copy_open62541_dll
        COMMAND ${CMAKE_COMMAND} -E copy
                ${CMAKE_SOURCE_DIR}/shared_62541/open62541.dll
                ${CMAKE_CURRENT_BINARY_DIR}/Debug/open62541.dll
        COMMENT "open62541.dll has been copied to output directory.")

add_dependencies(${PROJECT_NAME} copy_open62541_dll)
